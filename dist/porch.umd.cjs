(function(i,a){typeof exports=="object"&&typeof module!="undefined"?a(exports):typeof define=="function"&&define.amd?define(["exports"],a):(i=typeof globalThis!="undefined"?globalThis:i||self,a(i.porch={}))})(this,function(i){"use strict";const a=(c,e)=>c.reduce((t,r)=>t.length&&t[t.length-1].length<e?(t[t.length-1].push(r),t):[...t,[r]],[]);class P{constructor(){this.readable=!0,this.listeners={}}getListeners(e){return this.listeners[e]||[]}on(e,t){return Object.assign(this.listeners,{[e]:this.getListeners(e).concat(t)}),this}off(e,t){return Object.assign(this.listeners,{[e]:this.getListeners(e).filter(r=>r!==t)}),this}emit(e,t){setTimeout(()=>{this.getListeners(e).forEach(r=>r(t))})}push(e){return e===null?this.emit("end"):this.emit("data",e)}}const j=(c,e=1,t=0,r=!0)=>{const u=new P({objectMode:!0,read(){}});let l=!1;const h=s=>{l=!0,u.emit("error",s)},n=s=>!l&&u.readable&&u.push(s),o=(s,d=0)=>{if(!s.length)return n(null);const m=(T,b)=>{const g=d*e+b;return T().then(f=>n({idx:g,result:f})).catch(f=>r?h(Object.assign(f,{idx:g})):n({idx:g,result:f}))};return Promise.all(s[0].map(m)).then(()=>s.length<=1?n(null):setTimeout(()=>!l&&u.readable&&o(s.slice(1),d+1),t))};return o(a(c,e)),u},p=(c,e,t=0,r=!0)=>{const u=(l,h=[])=>l.length?Promise.all(l[0].map(n=>r?n():n().catch(o=>o))).then(n=>{const o=[...h,...n];return l.length<=1?o:new Promise((s,d)=>setTimeout(()=>u(l.slice(1),o).then(s,d),t))}):Promise.resolve(h);return u(a(c,e))};i.createPromise=p,i.createStream=j,i.default=p,Object.defineProperties(i,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
