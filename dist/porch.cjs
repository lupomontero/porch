"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const d=(o,e)=>o.reduce((t,r)=>t.length&&t[t.length-1].length<e?(t[t.length-1].push(r),t):[...t,[r]],[]);class m{constructor(){this.readable=!0,this.listeners={}}getListeners(e){return this.listeners[e]||[]}on(e,t){return Object.assign(this.listeners,{[e]:this.getListeners(e).concat(t)}),this}off(e,t){return Object.assign(this.listeners,{[e]:this.getListeners(e).filter(r=>r!==t)}),this}emit(e,t){setTimeout(()=>{this.getListeners(e).forEach(r=>r(t))})}push(e){return e===null?this.emit("end"):this.emit("data",e)}}const L=(o,e=1,t=0,r=!0)=>{const i=new m({objectMode:!0,read(){}});let l=!1;const a=s=>{l=!0,i.emit("error",s)},n=s=>!l&&i.readable&&i.push(s),u=(s,c=0)=>{if(!s.length)return n(null);const p=(P,j)=>{const g=c*e+j;return P().then(h=>n({idx:g,result:h})).catch(h=>r?a(Object.assign(h,{idx:g})):n({idx:g,result:h}))};return Promise.all(s[0].map(p)).then(()=>s.length<=1?n(null):setTimeout(()=>!l&&i.readable&&u(s.slice(1),c+1),t))};return u(d(o,e)),i},f=(o,e,t=0,r=!0)=>{const i=(l,a=[])=>l.length?Promise.all(l[0].map(n=>r?n():n().catch(u=>u))).then(n=>{const u=[...a,...n];return l.length<=1?u:new Promise((s,c)=>setTimeout(()=>i(l.slice(1),u).then(s,c),t))}):Promise.resolve(a);return i(d(o,e))};exports.createPromise=f;exports.createStream=L;exports.default=f;
